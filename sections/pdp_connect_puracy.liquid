<!-- WWAI_PRODUCT_CONNECTOR: Start -->
{% if all_products != blank %}
    {%- assign product_mapping_str = "
        natural-laundry-stain-remover-wwai-1:natural-laundry-stain-remover-wwai-1:natural-laundry-stain-remover,
        natural-laundry-detergent:natural-laundry-detergent:natural-laundry-detergent,
        laundry-stain-remover-brush:laundry-stain-remover-brush:laundry-stain-remover-brush
      " -%}
      
      
      <script>
      window.JS_PRODUCT_MAPPING_OBJECT = {};
      </script>

      {%- assign deploy_mode = "prod" -%}
      {%- assign use_mock_subscription = false -%}
      {%- if deploy_mode == "local" or deploy_mode == "sandbox" -%}
          {%- assign use_mock_subscription = true -%}
      {%- endif -%}
    
      <script>
    {%- assign cleaned_mapping_str = product_mapping_str | strip | strip_newlines -%}
    {%- assign product_mapping_array = cleaned_mapping_str | split: "," -%}
  
    {% assign unique_product_group_tags = "" %}
    {% for item in product_mapping_array %}
      {% assign parts = item | strip | split: ":" %}
      {% assign product_group_tag = parts[0] %}
      {% assign product_tag = parts[1] %}
      {% assign product_handle = parts[2] %}
      {% assign current_tags = unique_product_group_tags_array | split: "," %}

      {% unless current_tags contains product_group_tag %}
        {% assign unique_product_group_tags = unique_product_group_tags | append: product_group_tag | append: "," %}
      {% endunless %}
    {% endfor %}

    {% assign unique_product_group_tags = unique_product_group_tags | split: "," | uniq %}

    // Ensure SECTION_DATA is initialized
    window.SECTION_DATA = window.SECTION_DATA || {};
    if (window.SECTION_DATA["all_sections"]) {
      console.warn("‚ö†Ô∏è window.SECTION_DATA.all_sections is already initialized. Skipping initialization.");
    } else {
        window.SECTION_DATA["all_sections"] = {};
        Object.assign(window.SECTION_DATA["all_sections"], {
          storeData: {
            useMockSubscription: {{ use_mock_subscription }},
            deployMode: "{{ deploy_mode }}",
  
            storeDataConnected: true,
            
            dummyPrice: "{{ 100 | money }}",
            productGroups: {      
              {% for product_group_tag in unique_product_group_tags %}
                {% if product_group_tag != "" %}
                "{{ product_group_tag }}": {
                  {% for item in product_mapping_array %}
                    {% assign parts = item | strip | split: ":" %}
                    {% assign group_tag = parts[0] %}
                    {% assign product_tag = parts[1] %}
                    {% assign product_handle = parts[2] %}
                    {% if group_tag == product_group_tag %}
                      "{{ product_tag }}": {{ all_products[product_handle] | json }}{% unless forloop.last %},{% endunless %}
                    {% endif %}
                  {% endfor %}
                }{% unless forloop.last %},{% endunless %}
                {% endif %}
              {% endfor %}
            },
      
            variantSellingPlans: {
              {% for item in product_mapping_array %}
                {% assign parts = item | strip | split: ":" %}
                {% assign product_group_tag = parts[0] %}
                {% assign product_tag = parts[1] %}
                {% assign product_handle = parts[2] %}
                "{{ product_group_tag }}__{{ product_tag }}": {
                  "variants":
                    {%- assign product = all_products[product_handle] -%}
                    {%- assign subscription_plan_metaobj = product.metafields.custom.subscription_selling_plan.value['selling_plan_groups'] -%}
                    {%- assign subscription_plan_provider = product.selling_plan_groups -%}
                    {%- assign product_variants_metaobj = product.metafields.custom.variant_selling_plan.value['variants'] -%}
                    {%- assign product_variants_shopify = product.variants -%}
      
                    {%- if use_mock_subscription -%}
                      {{ product_variants_metaobj | json }}
                    {%- else -%}
                      {{ product_variants_shopify | json }}
                    {%- endif -%},
                  "selling_plan_groups":
                    {%- if use_mock_subscription -%}
                      {{ subscription_plan_metaobj | json }}
                    {%- else -%}
                      {{ subscription_plan_provider | json }}
                    {%- endif -%}
                }{% unless forloop.last %},{% endunless %}
              {% endfor %}
            }
          }
        });
    }
  
    function initLiquidProductMappingArray(liquidArrayFromTheme) {
      const existing = window.LIQUID_PRODUCT_MAPPING_ARRAY;
    
      if (!Array.isArray(liquidArrayFromTheme)) {
        console.error("‚ùå Provided liquid mapping is not a valid array.");
        return;
      }
    
      if (!existing) {
        window.LIQUID_PRODUCT_MAPPING_ARRAY = liquidArrayFromTheme;
        return;
      }
    
      // Check for equality (order matters)
      const isEqual = (
        existing.length === liquidArrayFromTheme.length &&
        existing.every((entry, i) => entry === liquidArrayFromTheme[i])
      );
    
      if (!isEqual) {
        console.error("‚ùå Conflict: LIQUID_PRODUCT_MAPPING_ARRAY already exists and does not match the one from Liquid.");
        console.log("üîÅ Existing:", existing);
        console.log("üÜï Incoming from Liquid:", liquidArrayFromTheme);
      } else {
        console.log("‚úÖ Liquid mapping array matches existing global value.");
      }
    }
    initLiquidProductMappingArray({{ product_mapping_array | json }});

    function inferPriceDetails() {
      const currency = Shopify.currency.active;
      window.CURRENCY = currency;
      window.CURRENCY_FACTOR = 0.01;
    }
    inferPriceDetails();
  </script>
    


<script>
window.WWAI_PRODUCT_GROUP_CONFIG = {
  "product_section_puracy_gFXzY8": {
    "defaults": {
      "pricingConfig": {
       "discountPercent": 0,
        "subscriptionDiscountPercent": 0,
        "defaultSubscriptionOption": null,
        "discountCodeToApply": ["PURACY25", "PURACY20"],
        "roundDiscount": true,
        "addOffSuffixToDiscount": false
      },
      "uxConfig": {
        "variantOptionRemovePrefix": "Every",
        "defaultPurchaseType": "subscription"
      },
      "flowConfig": {
        "destination": "checkout",
        "clearCartBeforeAddingItems": true,
        "loader": "add-to-cart-submit-button",
        "showSuccessNotification": false,
        "showErrorNotification": true,
        "sideCartLabel": "puracy",
        "successNotificationMessage": "‚úÖ Added to cart!",
        "errorNotificationMessage": "Oops, couldn't add item.",
        "notificationOptions": {
          "backgroundColor": "#FFFFFF",
          "textColor": "#000000",
          "borderColor": "#000000",
          "fontFamily": "Arial, sans-serif"
        }
      }
    },
    "natural-laundry-stain-remover-wwai-1": {
      "pricingConfig": null,
      "uxConfig": null,
      "flowConfig": null,
      "variantDispatchConfig": {
        "defaultProduct": "natural-laundry-stain-remover-wwai-1",
        "defaultVariantOption1": "Unscented",
        "defaultVariantOption2": "Travel",
        "defaultVariantOption3": null,
        "allProducts": "natural-laundry-stain-remover-wwai-1",
        "allOptions": {
          "option1": "Unscented",
          "option2": "Travel | Travel (Pack of 2) | Standard | Standard (Pack of 2) | Standard & Refill | Refill | Refill (Pack of 2)",
          "option3": ""
        }
      }
    }
  },
  "nwkw_val_zive_20fab_wwai_products_grid_1_T4jjed": {
    "defaults": {
      "pricingConfig": {
        "discountPercent": 0,
        "subscriptionDiscountPercent": 0,
        "defaultSubscriptionOption": null,
        "discountCodeToApply": ["PURACY25", "PURACY20"],
        "roundDiscount": true,
        "addOffSuffixToDiscount": false
      },
      "uxConfig": {
        "variantOptionRemovePrefix": "Every",
        "defaultPurchaseType": "onetime"
      },
      "flowConfig": {
        "destination": "checkout",
        "clearCartBeforeAddingItems": true,
        "loader": "add-to-cart-submit-button",
        "showSuccessNotification": false,
        "showErrorNotification": true,
        "sideCartLabel": "puracy",
        "successNotificationMessage": "‚úÖ Added to cart!",
        "errorNotificationMessage": "Oops, couldn't add item.",
        "notificationOptions": {
          "backgroundColor": "#FFFFFF",
          "textColor": "#000000",
          "borderColor": "#000000",
          "fontFamily": "Arial, sans-serif"
        }
      }
    },
    "natural-laundry-detergent": {
      "pricingConfig": null,
      "uxConfig": null,
      "flowConfig": null,
      "variantDispatchConfig": {
        "defaultProduct": "natural-laundry-detergent",
        "defaultVariantOption1": "Unscented",
        "defaultVariantOption2": "Standard",
        "defaultVariantOption3": null,
        "allProducts": "natural-laundry-detergent",
        "allOptions": {
          "option1": "Free & Clear | Fresh Linen | Cherry Blossom",
          "option2": "16oz | 16oz (Pack of 2) | 16oz & 48oz Bundle | 48oz Refill | 48oz Refill (Pack of 2)",
          "option3": ""
        }
      }
    },
    "laundry-stain-remover-brush": {
      "pricingConfig": null,
      "uxConfig": null,
      "flowConfig": null,
      "variantDispatchConfig": {
        "defaultProduct": "laundry-stain-remover-brush",
        "defaultVariantOption1": "One size",
        "defaultVariantOption2": null,
        "defaultVariantOption3": null,
        "allProducts": "laundry-stain-remover-brush",
        "allOptions": {
          "option1": "One size",
          "option2": "",
          "option3": ""
        }
      }
    }
  }
};
</script>


<script>
    window.WWAI_PRODUCT_VARIANT_OVERRIDES = {
      "product_section_puracy_gFXzY8": {
        "natural-laundry-stain-remover-wwai-1": {
          "natural-laundry-stain-remover-wwai-1": {
            "Unscented | Travel": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Travel (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Standard": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Standard (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Standard & Refill": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Refill": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Unscented | Refill (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            }
          }
        }
      },
      "nwkw_val_zive_20fab_wwai_products_grid_1_T4jjed": {
        "natural-laundry-detergent": {
          "natural-laundry-detergent": {
            "Free & Clear | 16oz": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Free & Clear | 16oz (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Free & Clear | 16oz & 48oz Bundle": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Free & Clear | 48oz Refill": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Free & Clear | 48oz Refill (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Fresh Linen | 16oz": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Fresh Linen | 16oz (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Fresh Linen | 16oz & 48oz Bundle": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Fresh Linen | 48oz Refill": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Fresh Linen | 48oz Refill (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Cherry Blossom | 16oz": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Cherry Blossom | 16oz (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Cherry Blossom | 16oz & 48oz Bundle": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Cherry Blossom | 48oz Refill": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            },
            "Cherry Blossom | 48oz Refill (Pack of 2)": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            }
          }
        },
        "laundry-stain-remover-brush": {
          "laundry-stain-remover-brush": {
            "One size": {
              "customMediaLabel": null,
              "redirectToMediaIndex": null,
              "customLabelText": {}
            }
          }
        }
      }
    };
    </script>

            <script>
                window.WWAI_LABELED_IMAGES = {};
                </script>
                  
  <script src="{{ 'functionality-generator.js' | asset_url }}" defer></script>
  {% endif %}
  
  {% schema %}
  {
    "name": "Empty Section",
    "class": "empty-section",
    "settings": [],
    "blocks": [],
    "presets": [
      {
        "name": "Default",
        "category": "Custom"
      }
    ]
  }
  {% endschema %}
  

{% comment %} 

"pdp_connect": {
    "type": "pdp_connect_puracy",
    "settings": {
    }
} 

{% endcomment %}
