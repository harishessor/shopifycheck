{%- if section.blocks.size > 0 -%}
  {%- comment -%}
  ------------------------------------------------------------------------------------------------------------------------
  CSS
  ------------------------------------------------------------------------------------------------------------------------
  {%- endcomment -%}

   <style>
    #shopify-section-{{ section.id }} {
      --multiple-media-with-text-grid: {% if section.settings.media_position_mobile == 'before_text' %}"media-wrapper" "content-wrapper"{% else %}"content-wrapper" "media-wrapper"{% endif %} / minmax(0, 1fr);
      --multiple-media-with-text-media-alignment-offset: {{ section.settings.media_mobile_alignment_offset }}px;
      --multiple-media-with-text-media-grid: auto var(--multiple-media-with-text-media-grid-auto-rows) / auto-flow var(--multiple-media-with-text-media-grid-auto-columns);
      --multiple-media-with-text-media-gap: 0.5rem;

      {%- capture grid_auto_rows -%}
        {%- if section.settings.media_alignment == 'start' -%}
          [offset-start] minmax(0, var(--multiple-media-with-text-media-alignment-offset)) [offset-end main-start] minmax(0, 1fr) [main-end]
        {%- elsif section.settings.media_alignment == 'end' -%}
          [main-start] minmax(0, 1fr) [main-end offset-start] minmax(0, var(--multiple-media-with-text-media-alignment-offset)) [offset-end]
        {%- endif -%}
      {%- endcapture -%}

      {%- capture grid_auto_columns -%}       
          minmax(0, 1fr)       
      {%- endcapture -%}

      --multiple-media-with-text-media-grid-auto-rows: {{- grid_auto_rows -}};
      --multiple-media-with-text-media-grid-auto-columns: {{- grid_auto_columns -}};
    }

    @media screen and (min-width: 700px) {
      #shopify-section-{{ section.id }} {
        --multiple-media-with-text-media-alignment-offset: {{ section.settings.media_alignment_offset }}px;
        --multiple-media-with-text-media-gap: 0.625rem;

        {%- capture grid_auto_columns -%}          
            minmax(0, 1fr) minmax(0, 1fr)          
        {%- endcapture -%}

        --multiple-media-with-text-media-grid-auto-columns: {{- grid_auto_columns -}};
      }
    }

    @media screen and (min-width: 1000px) {
      #shopify-section-{{ section.id }} {
        --multiple-media-with-text-grid: {% if section.settings.media_position_desktop == 'before_text' %}"media-wrapper content-wrapper" / minmax(0, 1fr) minmax(0, calc(50% - 60px/2)){% else %}"content-wrapper media-wrapper" / minmax(0, calc(50% - 60px/2)) minmax(0, 1fr){% endif %};
      }
    }
  </style>

  {%- comment -%}
  ------------------------------------------------------------------------------------------------------------------------
  LIQUID
  ------------------------------------------------------------------------------------------------------------------------
  {%- endcomment -%}

  {%- assign color_scheme_hash = section.settings.color_scheme.settings.background_gradient | default: section.settings.color_scheme.settings.background | md5 -%}

  <div class="section-spacing color-scheme color-scheme--{{ section.settings.color_scheme.id }} color-scheme--bg-{{ color_scheme_hash }} {% if section.settings.separate_section_with_border %}bordered-section{% endif %}">
    <div class="container container--lg">       
      <div class="section-stack">

        {%- render 'section-header', subheading: section.settings.subheading, heading: section.settings.title, content: section.settings.content -%}

        <!-- DESKTOP LAYOUT -->
        <x-tabs class="content-tabs text-align--{{ section.settings.text_align }} hidden sm:block">
            <template shadowrootmode="open">
                <slot role="tablist" part="tab-list" name="title"></slot>
                <slot part="tab-panel-list" name="content"></slot>
            </template>
            {%- for block in section.blocks -%}

                <button class="h6" type="button" role="tab" slot="title" {{ block.shopify_attributes }}>{{ block.settings.tab_title }}</button>

                <div role="tabpanel" slot="content" {% cycle '', 'hidden', 'hidden', 'hidden', 'hidden' %}>
                    <multiple-media-with-text {% if section.settings.reveal_on_scroll %}reveal-on-scroll="true"{% endif %} class="multiple-media-with-text {% if section.settings.media_position_desktop == 'after_text' %}multiple-media-with-text--reverse{% endif %}">
                        <div class="multiple-media-with-text__media-wrapper">         
                            
                            <div {{ block.shopify_attributes }} class="align-self-{{ section.settings.media_alignment }}" style="--media-rotate: {{ block.settings.rotation }}deg; {% if forloop.first %}{% if section.settings.media_alignment == 'start' %}grid-row-start: offset-end;{% elsif section.settings.media_alignment == 'end' %}grid-row-end: main-end;{% endif %}{% endif %}">
                            {%- if block.settings.image != blank -%}
                                {%- liquid
                                assign loading_strategy = 'lazy'

                                if section.index <= 3 and forloop.first
                                    assign loading_strategy = 'eager'
                                endif
                                -%}

                                {%- capture sizes_attribute -%}{% if loading_strategy != 'eager' %}auto, {% endif %}(max-width: 699px) 50vw, 500px{%- endcapture -%}
                                {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: sizes_attribute, widths: '200,300,400,500,600,700,800,900,1000,1200,1400' -}}
                            
                            {%- else -%}              
                                
                                {%- capture placeholder -%}collection-{{ forloop.index }}{%- endcapture -%}
                                {%- capture placeholder_class -%}{% cycle 'placeholder', 'placeholder placeholder--invert' %}{%- endcapture -%}
                                {{- placeholder | placeholder_svg_tag: placeholder_class -}}
                            
                            {%- endif -%}
                            </div>          
                        
                        </div>
                        <div class="multiple-media-with-text__content-wrapper align-self-{{ section.settings.text_alignment }}">
                            <div class="prose">
                                {%- if block.settings.subheading != blank -%}
                                <p class="h6">{{ block.settings.subheading }}</p>
                                {%- endif -%}

                                {%- if block.settings.title != blank -%}
                                <p class="h2">{{ block.settings.title }}</p>
                                {%- endif -%}

                                {{- block.settings.content -}}

                                {%- if block.settings.button_1_text != blank or block.settings.button_2_text != blank -%}
                                <div class="button-group">
                                    {%- if block.settings.button_1_text != blank -%}
                                    {%- render 'button', href: block.settings.button_1_link, content: block.settings.button_1_text, style: block.settings.button_1_style -%}
                                    {%- endif -%}

                                    {%- if block.settings.button_2_text != blank -%}
                                    {%- render 'button', href: block.settings.button_2_link, content: block.settings.button_2_text, style: block.settings.button_2_style -%}
                                    {%- endif -%}
                                </div>
                                {%- endif -%}
                            </div>
                        </div>
                    </multiple-media-with-text>
                </div>

            {%- endfor -%}
        </x-tabs>

        <!-- MOBILE LAYOUT -->
        <div class="accordion-group sm:hidden">
          {%- for block in section.blocks -%}
            {%- liquid
              assign title = block.settings.tab_title
            -%}

            {% capture content %}
              <multiple-media-with-text {% if section.settings.reveal_on_scroll %}reveal-on-scroll="true"{% endif %} class="multiple-media-with-text {% if section.settings.media_position_desktop == 'after_text' %}multiple-media-with-text--reverse{% endif %}">
                  <div class="multiple-media-with-text__media-wrapper">         
                      
                      <div {{ block.shopify_attributes }} class="align-self-{{ section.settings.media_alignment }}" style="--media-rotate: {{ block.settings.rotation }}deg; {% if forloop.first %}{% if section.settings.media_alignment == 'start' %}grid-row-start: offset-end;{% elsif section.settings.media_alignment == 'end' %}grid-row-end: main-end;{% endif %}{% endif %}">
                      {%- if block.settings.image != blank -%}
                          {%- liquid
                          assign loading_strategy = 'lazy'

                          if section.index <= 3 and forloop.first
                              assign loading_strategy = 'eager'
                          endif
                          -%}

                          {%- capture sizes_attribute -%}{% if loading_strategy != 'eager' %}auto, {% endif %}(max-width: 699px) 50vw, 500px{%- endcapture -%}
                          {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: sizes_attribute, widths: '200,300,400,500,600,700,800,900,1000,1200,1400' -}}
                      
                      {%- else -%}              
                          
                          {%- capture placeholder -%}collection-{{ forloop.index }}{%- endcapture -%}
                          {%- capture placeholder_class -%}{% cycle 'placeholder', 'placeholder placeholder--invert' %}{%- endcapture -%}
                          {{- placeholder | placeholder_svg_tag: placeholder_class -}}
                      
                      {%- endif -%}
                      </div>          
                  
                  </div>
                  <div class="multiple-media-with-text__content-wrapper align-self-{{ section.settings.text_alignment }}">
                      <div class="prose">
                          {%- if block.settings.subheading != blank -%}
                          <p class="h6">{{ block.settings.subheading }}</p>
                          {%- endif -%}

                          {%- if block.settings.title != blank -%}
                          <p class="h2">{{ block.settings.title }}</p>
                          {%- endif -%}

                          {{- block.settings.content -}}

                          {%- if block.settings.button_1_text != blank or block.settings.button_2_text != blank -%}
                          <div class="button-group">
                              {%- if block.settings.button_1_text != blank -%}
                              {%- render 'button', href: block.settings.button_1_link, content: block.settings.button_1_text, style: block.settings.button_1_style -%}
                              {%- endif -%}

                              {%- if block.settings.button_2_text != blank -%}
                              {%- render 'button', href: block.settings.button_2_link, content: block.settings.button_2_text, style: block.settings.button_2_style -%}
                              {%- endif -%}
                          </div>
                          {%- endif -%}
                      </div>
                  </div>
              </multiple-media-with-text>
            {% endcapture %}

            {% assign open_first = false %}
            {% if forloop.index == 1 %}
              {% assign open_first = true %}
            {% endif %}
            
            {%- if title != blank and content != blank -%}
              {%- render 'accordion', title: title, content: content, open: open_first, prose_content: true -%}
            {%- endif -%}
          {%- endfor -%}
        </div>
      
      </div>

    </div>
  </div>
{%- endif -%}

<style>
  #shopify-section-{{ section.id }} .content-tabs.text-align--left .multiple-media-with-text__content-wrapper {
    text-align: left;
  }
  #shopify-section-{{ section.id }} .content-tabs.text-align--center .multiple-media-with-text__content-wrapper {
    text-align: center;
  }
  #shopify-section-{{ section.id }} .content-tabs.text-align--right .multiple-media-with-text__content-wrapper {
    text-align: right;
  }
  #shopify-section-{{ section.id }} .content-tabs.text-align--center .multiple-media-with-text__content-wrapper .button-group {
    justify-content: center;
  }
  #shopify-section-{{ section.id }} .content-tabs.text-align--right .multiple-media-with-text__content-wrapper .button-group {
    justify-content: flex-end;
  }
  #shopify-section-{{ section.id }} .multiple-media-with-text {
    --multiple-media-with-text-gap: 2rem 60px;
  }
  #shopify-section-{{ section.id }} .content-tabs::part(tab-list) {
    justify-content: center;
    border: 0;
    gap: 15px;
    margin-block-end: 3.5rem;
  }
  #shopify-section-{{ section.id }} .content-tabs [role="tab"] {
    opacity: 1 !important;
    padding: 13px 24px;
    border: 1px solid #04777f;
    border-radius: 999px;
    color: #04777f;
    transition: 0.2s;
    cursor: pointer;
    font-size: 16px;
    font-style: normal;
    font-weight: 700;
    line-height: normal;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    box-shadow: none;
  }
  #shopify-section-{{ section.id }} .content-tabs [role="tab"]:hover,
  #shopify-section-{{ section.id }} .content-tabs [role="tab"][aria-selected="true"] {
    background: #d9ede9;
    border-color: #04777f;
  }
  #shopify-section-{{ section.id }} .section-stack {
    gap: 30px; 
  }
  
  @media(max-width: 767px) {
    #shopify-section-{{ section.id }} .multiple-media-with-text {
      display: flex;
      flex-direction: column-reverse;
    }
  }
</style>


{% schema %}
{
  "name": "Image with text tabs",
  "class": "shopify-section--image-with-text-tabs",
  "tag": "section",
  "max_blocks": 3,
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "reveal_on_scroll",
      "label": "t:global.animation.reveal_on_scroll",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "separate_section_with_border",
      "label": "t:global.section.separate_section_with_border",
      "default": true
    },
    {
      "type": "inline_richtext",
      "id": "subheading",
      "label": "t:global.text.subheading"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "t:global.text.heading",
      "default": "Powerful Clean, Good for All"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "t:global.text.content",
      "default": "<p>Showcase your product benefit by using before/after image comparison.</p>"
    },
    {
      "type": "header",
      "content": "t:sections.multiple_media_with_text.order_category"
    },
    {
      "type": "select",
      "id": "media_position_desktop",
      "label": "t:sections.multiple_media_with_text.media_position_desktop",
      "options": [
        {
          "value": "before_text",
          "label": "t:global.position.left"
        },
        {
          "value": "after_text",
          "label": "t:global.position.right"
        }
      ],
      "default": "before_text"
    },
    {
      "type": "select",
      "id": "media_position_mobile",
      "label": "t:sections.multiple_media_with_text.media_position_mobile",
      "options": [
        {
          "value": "before_text",
          "label": "t:sections.multiple_media_with_text.media_position_mobile_options.before_text"
        },
        {
          "value": "after_text",
          "label": "t:sections.multiple_media_with_text.media_position_mobile_options.after_text"
        }
      ],
      "default": "before_text"
    },
    {
      "type": "header",
      "content": "t:sections.multiple_media_with_text.media_category",
      "info": "t:sections.multiple_media_with_text.media_category_info"
    },
    {
      "type": "select",
      "id": "media_alignment",
      "label": "t:sections.multiple_media_with_text.media_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:global.position.top"
        },
        {
          "value": "center",
          "label": "t:global.position.middle"
        },
        {
          "value": "end",
          "label": "t:global.position.bottom"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "media_alignment_offset",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.multiple_media_with_text.media_alignment_offset",
      "default": 0
    },
    {
      "type": "range",
      "id": "media_mobile_alignment_offset",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.multiple_media_with_text.media_mobile_alignment_offset",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:sections.multiple_media_with_text.content_category"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "t:sections.multiple_media_with_text.content_vertical_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:global.position.top"
        },
        {
          "value": "center",
          "label": "t:global.position.middle"
        },
        {
          "value": "end",
          "label": "t:global.position.bottom"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text Align",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:global.image.image",
          "info": "t:sections.multiple_media_with_text.blocks.image.image_size_recommendation"
        },
        {
            "type": "inline_richtext",
            "id": "subheading",
            "label": "t:global.text.subheading",
            "default": "About"
        },
        {
            "type": "inline_richtext",
            "id": "title",
            "label": "t:global.text.heading",
            "default": "Showcase your product"
        },
        {
            "type": "richtext",
            "id": "content",
            "label": "t:global.text.content",
            "default": "<p>Write some content about your products, collections or brand. Use image or video to create an impactful layout.</p>"
        },
        {
            "type": "header",
            "content": "t:global.text.button_1_category"
        },
        {
            "type": "text",
            "id": "button_1_text",
            "label": "t:global.text.text"
        },
        {
            "type": "url",
            "id": "button_1_link",
            "label": "t:global.text.link"
        },
        {
            "type": "select",
            "id": "button_1_style",
            "label": "t:global.text.style",
            "options": [
            {
                "value": "outline",
                "label": "t:global.text.link_style_options.outline"
            },
            {
                "value": "solid",
                "label": "t:global.text.link_style_options.solid"
            },
            {
                "value": "link",
                "label": "t:global.text.link_style_options.link"
            }
            ],
            "default": "solid"
        },
        {
            "type": "header",
            "content": "t:global.text.button_2_category"
        },
        {
            "type": "text",
            "id": "button_2_text",
            "label": "t:global.text.text"
        },
        {
            "type": "url",
            "id": "button_2_link",
            "label": "t:global.text.link"
        },
        {
            "type": "select",
            "id": "button_2_style",
            "label": "t:global.text.style",
            "options": [
            {
                "value": "outline",
                "label": "t:global.text.link_style_options.outline"
            },
            {
                "value": "solid",
                "label": "t:global.text.link_style_options.solid"
            },
            {
                "value": "link",
                "label": "t:global.text.link_style_options.link"
            }
            ],
            "default": "solid"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with text tabs",
      "blocks": [
        {
          "type": "tab"
        },
        {
          "type": "tab"
        }
      ]
    }
  ]
}
{% endschema %}
